(this.webpackJsonpjira=this.webpackJsonpjira||[]).push([[0],{287:function(e,t,n){},288:function(e,t,n){},298:function(e,t){},470:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(39),o=n.n(a),i=(n(287),n(288),n(86)),u=n(21),s=n.n(u),j=n(55),l="http://online.com",d="__auth_provider_token__",b=function(e){var t=e.user;return window.localStorage.setItem(d,t.token||""),t},O=function(){var e=Object(j.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.localStorage.removeItem(d));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),f=n(35),h=n(63),p=n(253),x=n.n(p),m=["data","token","headers"],v="http://online.com",g=function(){var e=Object(j.a)(s.a.mark((function e(t){var n,r,c,a,o,i=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.data,c=n.token,n.headers,a=Object(h.a)(n,m),"GET"===(o=Object(f.a)({method:"GET",headers:{Authorization:c?"Bearer ".concat(c):"","Content-Type":r?"application/json":""}},a)).method.toUpperCase()?t+="?".concat(x.a.stringify(r)):o.body=JSON.stringify(r||{}),e.abrupt("return",window.fetch("".concat(v,"/").concat(t),o).then(function(){var e=Object(j.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(401!==t.status){e.next=5;break}return e.next=3,O();case 3:return window.location.reload(),e.abrupt("return",Promise.reject({message:"\u8bf7\u91cd\u65b0\u767b\u5f55"}));case 5:return e.next=7,t.json();case 7:if(n=e.sent,!t.ok){e.next=12;break}return e.abrupt("return",n);case 12:return e.abrupt("return",Promise.reject(n));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Y().user;return Object(r.useCallback)((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var c=n[0],a=n[1];return g(c,Object(f.a)(Object(f.a)({},a),{},{token:null===e||void 0===e?void 0:e.token}))}),[null===e||void 0===e?void 0:e.token])},k=(n(104),n(29)),w=function(e){var t=Object(f.a)({},e);return Object.keys(t).forEach((function(e){(function(e){return""!==(null!==e&&void 0!==e?e:"")})(t[e])||delete t[e]})),t},C=function(){return window.location.href=window.location.origin},E={stat:"idle",data:null,error:null},I={throwOnError:!1},S=function(e,t){var n=Object(f.a)(Object(f.a)({},I),t),c=Object(r.useState)(Object(f.a)(Object(f.a)({},E),e)),a=Object(k.a)(c,2),o=a[0],i=a[1],u=function(){var e=Object(r.useRef)(!1);return Object(r.useEffect)((function(){return e.current=!0,function(){e.current=!1}})),e}(),s=Object(r.useState)((function(){return function(){}})),j=Object(k.a)(s,2),l=j[0],d=j[1],b=Object(r.useCallback)((function(e){return i({data:e,stat:"success",error:null})}),[]),O=Object(r.useCallback)((function(e){return i({error:e,stat:"error",data:null})}),[]),h=Object(r.useCallback)((function(e,t){if(!e||!e.then)throw new Error("\u8bf7\u4f20\u5165 Promise \u7c7b\u578b\u6570\u636e");return d((function(){return function(){return(null===t||void 0===t?void 0:t.retry)&&h(null===t||void 0===t?void 0:t.retry(),t)}})),i((function(e){return Object(f.a)(Object(f.a)({},e),{},{stat:"loading"})})),e.then((function(e){return u.current&&b(e),e})).catch((function(e){return O(e),console.log(n.throwOnError,"config.throwOnError"),n.throwOnError?Promise.reject(e):e}))}),[n.throwOnError,u,b,O]);return Object(f.a)({isIdle:"idle"===o.stat,isLoading:"loading"===o.stat,isError:"error"===o.stat,isSuccess:"success"===o.stat,run:h,setData:b,setError:O,retry:l},o)},P=n(179),T=n(476),F=n(138),A=n(6),L=function(){return Object(A.jsx)("div",{style:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(A.jsx)(P.a,{size:"large"})})},M=function(e){var t=e.error;return Object(A.jsxs)("div",{style:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(A.jsx)(F.a,{}),Object(A.jsx)(D,{error:t})]})},D=function(e){var t,n=e.error;return(null===(t=n)||void 0===t?void 0:t.message)?Object(A.jsx)(T.a.Text,{type:"danger",children:n.message}):null},_=function(){var e=Object(j.a)(s.a.mark((function e(){var t,n,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!(n=window.localStorage.getItem(d))){e.next=7;break}return e.next=5,g("me",{token:n});case 5:r=e.sent,t=r.user;case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=c.a.createContext(void 0);q.displayName="AuthContext";var J,N,R=function(e){var t,n=e.children,c=S(),a=c.data,o=c.error,i=c.isLoading,u=c.isIdle,d=c.isError,f=c.run,h=c.setData;return t=function(){f(_())},Object(r.useEffect)((function(){return t()}),[]),u||i?Object(A.jsx)(L,{}):d?Object(A.jsx)(M,{error:o}):Object(A.jsx)(q.Provider,{value:{user:a,login:function(e){return(t=e,fetch("".concat(l,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){var e=Object(j.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=8;break}return e.t0=b,e.next=4,t.json();case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:return e.t2=Promise,e.next=11,t.json();case 11:return e.t3=e.sent,e.abrupt("return",e.t2.reject.call(e.t2,e.t3));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then(h);var t},register:function(e){return(t=e,fetch("".concat(l,"/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(){var e=Object(j.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.ok){e.next=8;break}return e.t0=b,e.next=4,t.json();case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:return e.t2=Promise,e.next=11,t.json();case 11:return e.t3=e.sent,e.abrupt("return",e.t2.reject.call(e.t2,e.t3));case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then(h);var t},logout:function(){return O().then((function(){return h(null)}))}},children:n})},Y=function(){var e=c.a.useContext(q);if(!e)throw new Error("useAuth\u5fc5\u987b\u5728AuthProvider\u4e2d\u4f7f\u7528");return e},z=n(475),B=n(182),H=n(103),Q=n(83),G=n(479),K=["checked","onCheckedChange"],U=function(e){var t=e.checked,n=e.onCheckedChange;Object(h.a)(e,K);return Object(A.jsx)(G.a,{count:1,value:t?1:0,onChange:function(e){return null===n||void 0===n?void 0:n(!!e)}})},V=n(137),W=["run"],X=function(e){var t=y();return Object(V.useQuery)(["projects",e],(function(){return t("projects",{data:e})}))},Z=n(262),$=n.n(Z),ee=n(152),te=function(e){var t=Object(Q.c)(),n=Object(k.a)(t,2),c=n[0],a=n[1];return[Object(r.useMemo)((function(){return e.reduce((function(e,t){return Object(f.a)(Object(f.a)({},e),{},Object(ee.a)({},t,c.get(t)||""))}),{})}),[c]),function(e){var t=w(Object(f.a)(Object(f.a)({},Object.fromEntries(c)),e));return a(t)}]},ne=function(){var e=te(["projectCreate"]),t=Object(k.a)(e,2),n=t[0].projectCreate,r=t[1];return{projectModalOpen:"true"===n,open:function(){return r({projectCreate:!0})},close:function(){return r({projectCreate:void 0})}}},re=["users"],ce=function(e){var t=e.users,n=Object(h.a)(e,re),r=ne().open,c=function(){var e=S(),t=e.run,n=Object(h.a)(e,W),r=y();return Object(f.a)({mutate:function(e){return t(r("projects/".concat(e.id),{data:e,method:"PATCH"}))}},n)}(),a=c.mutate;return Object(A.jsx)(z.a,Object(f.a)({pagination:!1,rowKey:"id",columns:[{title:Object(A.jsx)(U,{checked:!0,disabled:!0}),render:function(e,t){return Object(A.jsx)(U,{checked:t.pin,onCheckedChange:function(e){return a({id:t.id,pin:e})}})}},{title:"\u540d\u79f0",dataIndex:"name",sorter:function(e,t){return e.name.localeCompare(t.name)},render:function(e,t){return Object(A.jsx)(Q.b,{to:"project/".concat(String(t.id)),children:e})}},{title:"\u8d1f\u8d23\u4eba",render:function(e,n){var r;return(null===(r=t.find((function(e){return e.id===n.personId})))||void 0===r?void 0:r.name)||"\u672a\u77e5"}},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created",render:function(e){return e?$()(e).format("YYYY-MM-DD HH:mm:ss"):"-"}},{render:function(e,t){return Object(A.jsx)(B.a,{overlay:Object(A.jsx)(H.a,{children:Object(A.jsx)(H.a.Item,{children:Object(A.jsx)(i.a,{style:{padding:0},type:"link",onClick:r,children:"\u7f16\u8f91\u9879\u76ee"})},"edit")}),children:Object(A.jsx)(i.a,{type:"link",children:"..."})})}}]},n))},ae=n(478),oe=n(139),ie=function(e){var t=e.param,n=e.setParam,r=e.users;return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ae.a,{type:"text",value:t.name,onChange:function(e){return n(Object(f.a)(Object(f.a)({},t),{},{name:e.target.value}))}}),Object(A.jsxs)(oe.a,{value:t.personId,onChange:function(e){return n(Object(f.a)(Object(f.a)({},t),{},{personId:e}))},children:[Object(A.jsx)(oe.a.Option,{value:"",children:"\u8d1f\u8d23\u4eba"}),r.map((function(e){return Object(A.jsx)(oe.a.Option,{value:String(e.id),children:e.name},e.id)}))]})]})},ue=["run"],se=function(){var e=Object(r.useState)(["name","personId"]),t=Object(k.a)(e,1)[0],n=te(t),c=Object(k.a)(n,2),a=c[0],o=c[1],u=function(e,t){var n=Object(r.useState)(e),c=Object(k.a)(n,2),a=c[0],o=c[1];return Object(r.useEffect)((function(){var n=setTimeout((function(){return o(e)}),t);return function(){return clearTimeout(n)}}),[e,t]),a}(a,1e3),s=X(u),j=s.isLoading,l=s.error,d=s.data,b=function(e){var t=S(),n=t.run,c=Object(h.a)(t,ue),a=y();return Object(r.useEffect)((function(){n(a("users",{data:w(e||{})}))}),[e]),c}().data,O=ne().open;return function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(r.useRef)(document.title).current;Object(r.useEffect)((function(){document.title=e}),[e]),Object(r.useEffect)((function(){return function(){t||(document.title=n)}}),[t,n])}("\u9879\u76ee\u5217\u8868",!1),Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(ie,{users:b||[],param:a,setParam:o}),Object(A.jsx)(D,{error:l}),Object(A.jsx)(i.a,{style:{padding:0},type:"link",onClick:O,children:"\u521b\u5efa\u9879\u76ee"}),Object(A.jsx)(ce,{loading:j,users:b||[],dataSource:d||[]})]})},je=n(18),le=function(){return Object(A.jsx)(A.Fragment,{children:"EpicScreen"})},de=function(){return Object(A.jsx)(A.Fragment,{children:"KanbanScreen"})},be=function(){return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsxs)("header",{children:[Object(A.jsx)("h1",{children:"ProjectScreen"}),Object(A.jsx)(Q.b,{to:"kanban",children:"\u770b\u677f"}),Object(A.jsx)(Q.b,{to:"epic",children:"\u4efb\u52a1\u7ec4"})]}),Object(A.jsx)("main",{children:Object(A.jsxs)(je.c,{children:[Object(A.jsx)(je.a,{path:"/kanban",element:Object(A.jsx)(de,{})}),Object(A.jsx)(je.a,{path:"/epic",element:Object(A.jsx)(le,{})}),Object(A.jsx)(je.a,{index:!0,element:Object(A.jsx)(de,{})})]})})]})},Oe=n(480),fe=function(){var e=ne(),t=e.projectModalOpen,n=e.close;return Object(A.jsx)(Oe.a,{visible:t,onClose:n,width:"100%",children:Object(A.jsx)(i.a,{onClick:n,children:"\u5173\u95ed"})})},he=n(482),pe=n(474),xe=n(483),me=function(){var e=ne().open,t=X().data,n=null===t||void 0===t?void 0:t.filter((function(e){return e.pin})),r=Object(A.jsxs)("div",{children:[Object(A.jsx)(T.a.Text,{type:"secondary",children:"\u6536\u85cf\u9879\u76ee"}),Object(A.jsx)(he.b,{children:null===n||void 0===n?void 0:n.map((function(e){return Object(A.jsx)(he.b.Item,{children:Object(A.jsx)(he.b.Item.Meta,{title:e.name})},e.id)}))}),Object(A.jsx)(pe.a,{}),Object(A.jsx)(i.a,{style:{padding:0},type:"link",onClick:e,children:"\u521b\u5efa\u9879\u76ee"})]});return Object(A.jsx)(xe.a,{placement:"bottom",content:r,children:"\u9879\u76ee"})},ve=function(){var e=Y().logout;return Object(A.jsx)(A.Fragment,{children:Object(A.jsxs)(Q.a,{children:[Object(A.jsx)(i.a,{onClick:C,children:"\u9996\u9875"}),Object(A.jsx)(i.a,{onClick:e,children:"\u767b\u51fa"}),Object(A.jsx)(me,{}),Object(A.jsxs)(je.c,{children:[Object(A.jsx)(je.a,{path:"projects",element:Object(A.jsx)(se,{})}),Object(A.jsx)(je.a,{path:"projects/:projectId/*",element:Object(A.jsx)(be,{})}),Object(A.jsx)(je.a,{index:!0,element:Object(A.jsx)(se,{})})]}),Object(A.jsx)(fe,{})]})})},ge=n(154),ye=n(264),ke=n(155),we=n(181),Ce=function(e){Object(ke.a)(n,e);var t=Object(we.a)(n);function n(){var e;Object(ge.a)(this,n);for(var r=arguments.length,c=new Array(r),a=0;a<r;a++)c[a]=arguments[a];return(e=t.call.apply(t,[this].concat(c))).state={error:null},e}return Object(ye.a)(n,[{key:"render",value:function(){var e=this.state.error,t=this.props,n=t.fallbackRender,r=t.children;return e?n({error:e}):r}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}}]),n}(c.a.Component),Ee=n(209),Ie=n(211),Se=n(481),Pe=n(477),Te=function(e){var t=e.onError,n=Y().login,r=S(void 0,{throwOnError:!0}),c=r.run,a=r.isLoading,o=function(){var e=Object(j.a)(s.a.mark((function e(r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c(n(r));case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),t(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}();return Object(A.jsxs)(Pe.a,{onFinish:o,children:[Object(A.jsx)(Pe.a.Item,{name:"username",rules:[{required:!0,message:"\u8acb\u8f38\u5165\u7528\u6236\u540d"}],children:Object(A.jsx)(ae.a,{placeholder:"\u7528\u6236\u540d"})}),Object(A.jsx)(Pe.a.Item,{name:"password",rules:[{required:!0,message:"\u8acb\u8f38\u5165\u5bc6\u78bc"}],children:Object(A.jsx)(ae.a,{placeholder:"\u5bc6\u78bc"})}),Object(A.jsx)(Pe.a.Item,{children:Object(A.jsx)(i.a,{loading:a,htmlType:"submit",type:"primary",children:"\u767b\u5f55"})})]})},Fe=["cpassword"],Ae=function(e){var t=e.onError,n=Y().register,r=S(void 0,{throwOnError:!0}),c=r.run,a=r.isLoading,o=function(){var e=Object(j.a)(s.a.mark((function e(r){var a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.cpassword,o=Object(h.a)(r,Fe),a===o.password){e.next=4;break}return t(new Error("\u8bf7\u786e\u8ba4\u4e24\u6b21\u8f93\u5165\u7684\u5bc6\u7801\u76f8\u540c")),e.abrupt("return");case 4:return e.prev=4,e.next=7,c(n(o));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),t(e.t0);case 12:case"end":return e.stop()}}),e,null,[[4,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(A.jsxs)(Pe.a,{onFinish:o,children:[Object(A.jsx)(Pe.a.Item,{name:"username",rules:[{required:!0,message:"\u8acb\u8f38\u5165\u7528\u6236\u540d"}],children:Object(A.jsx)(ae.a,{placeholder:"\u7528\u6236\u540d"})}),Object(A.jsx)(Pe.a.Item,{name:"password",rules:[{required:!0,message:"\u8acb\u8f38\u5165\u5bc6\u78bc"}],children:Object(A.jsx)(ae.a,{placeholder:"\u5bc6\u78bc"})}),Object(A.jsx)(Pe.a.Item,{name:"cpassword",rules:[{required:!0,message:"\u8acb\u786e\u8ba4\u5bc6\u78bc"}],children:Object(A.jsx)(ae.a,{placeholder:"\u786e\u8ba4\u5bc6\u78bc"})}),Object(A.jsx)(Pe.a.Item,{children:Object(A.jsx)(i.a,{loading:a,htmlType:"submit",type:"primary",children:"\u6ce8\u518c"})})]})},Le=function(){var e=Object(r.useState)(!1),t=Object(k.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(null),o=Object(k.a)(a,2),u=o[0],s=o[1];return Object(A.jsx)(De,{style:{display:"flex",justifyContent:"center"},children:Object(A.jsxs)(Me,{children:[Object(A.jsx)(D,{error:u}),n?Object(A.jsx)(Ae,{onError:s}):Object(A.jsx)(Te,{onError:s}),Object(A.jsx)(pe.a,{}),Object(A.jsx)(i.a,{onClick:function(){return c(!n)},children:n?"\u5df2\u7ecf\u6709\u8d26\u53f7\u4e86?\u76f4\u63a5\u767b\u5f55":"\u6ca1\u6709\u8d26\u53f7?\u6ce8\u518c\u65b0\u8d26\u53f7"})]})})},Me=Object(Ie.a)(Se.a)(J||(J=Object(Ee.a)(["\n  width: 40rem;\n  min-height: 56rem;\n  padding: 3.2rem 4rem;\n  border-radius: 0.3rem;\n  box-sizing: border-box;\n  box-shadow: rgba(0, 0, 0, 0.1) 0 0 10px;\n  text-align: center;\n"]))),De=Ie.a.div(N||(N=Object(Ee.a)(["\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  min-height: 100vh;\n"])));var _e=function(){var e=Y().user;return Object(A.jsx)("div",{className:"App",children:Object(A.jsx)(Ce,{fallbackRender:M,children:e?Object(A.jsx)(ve,{}):Object(A.jsx)(Le,{})})})},qe=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,484)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))},Je=(n(469),function(e){var t=e.children;return Object(A.jsx)(V.QueryClientProvider,{client:new V.QueryClient,children:Object(A.jsx)(R,{children:t})})});Object(F.b)((function(){return o.a.render(Object(A.jsx)(c.a.StrictMode,{children:Object(A.jsxs)(Je,{children:[Object(A.jsx)(F.a,{}),Object(A.jsx)(_e,{})]})}),document.getElementById("root"))})),qe()}},[[470,1,2]]]);
//# sourceMappingURL=main.db47f4a3.chunk.js.map